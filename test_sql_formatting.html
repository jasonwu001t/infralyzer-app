<!DOCTYPE html>
<html>
<head>
    <title>SQL Formatting Test</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .container { display: flex; gap: 20px; }
        .section { flex: 1; }
        .sql-box { border: 1px solid #ccc; padding: 10px; min-height: 200px; background: #f9f9f9; white-space: pre-wrap; }
        button { padding: 10px 20px; margin: 10px 0; background: #007cba; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>SQL Formatting Test</h1>
    <div class="container">
        <div class="section">
            <h3>Original SQL</h3>
            <div class="sql-box" id="original"></div>
        </div>
        <div class="section">
            <h3>Formatted SQL</h3>
            <div class="sql-box" id="formatted"></div>
        </div>
    </div>
    <button onclick="testFormatting()">Test Formatting</button>

    <script>
        // SQL formatting function (same as in React component)
        function formatSQLQuery(sql) {
            let cleanSQL = sql.replace(/^--.*$/gm, '').replace(/\s+/g, ' ').trim()
            
            cleanSQL = cleanSQL
                .replace(/\bSELECT\b/gi, '\nSELECT')
                .replace(/\bFROM\b/gi, '\nFROM')
                .replace(/\bWHERE\b/gi, '\nWHERE')
                .replace(/\bGROUP BY\b/gi, '\nGROUP BY')
                .replace(/\bHAVING\b/gi, '\nHAVING')
                .replace(/\bORDER BY\b/gi, '\nORDER BY')
                .replace(/\bLIMIT\b/gi, '\nLIMIT')
                .replace(/\bJOIN\b/gi, '\nJOIN')
                .replace(/\bLEFT JOIN\b/gi, '\nLEFT JOIN')
                .replace(/\bRIGHT JOIN\b/gi, '\nRIGHT JOIN')
                .replace(/\bINNER JOIN\b/gi, '\nINNER JOIN')
                .replace(/\bUNION\b/gi, '\nUNION')
            
            const lines = cleanSQL.split('\n')
            const formattedLines = lines.map((line, index) => {
                const trimmedLine = line.trim()
                
                if (trimmedLine.startsWith('SELECT')) {
                    const selectPart = trimmedLine.substring(6).trim()
                    const nextKeywordIndex = lines.findIndex((l, i) => i > index && 
                        /^\s*(FROM|WHERE|GROUP|ORDER|LIMIT|HAVING)\b/i.test(l.trim()))
                    
                    if (nextKeywordIndex > index) {
                        const selectLines = lines.slice(index, nextKeywordIndex).join(' ')
                        const selectPart = selectLines.substring(6).trim()
                        const columns = selectPart.split(',').map(col => col.trim()).filter(col => col)
                        
                        if (columns.length > 1) {
                            return 'SELECT\n  ' + columns.join(',\n  ')
                        }
                    }
                    return trimmedLine
                }
                
                if (trimmedLine.startsWith('AND ') || trimmedLine.startsWith('OR ')) {
                    return '  ' + trimmedLine
                }
                
                return trimmedLine
            })
            
            return formattedLines
                .filter(line => line.trim().length > 0)
                .join('\n')
                .replace(/\n\s*\n/g, '\n')
                .trim()
        }

        function testFormatting() {
            // Test SQL from the API response
            const testSQL = "SELECT product_servicecode, ROUND(SUM(line_item_unblended_cost), 2) as total_cost FROM CUR WHERE line_item_usage_start_date >= DATE_TRUNC('month', CURRENT_DATE - INTERVAL '1 month') AND line_item_usage_start_date < DATE_TRUNC('month', CURRENT_DATE) AND line_item_unblended_cost > 0 GROUP BY 1 ORDER BY 2 DESC LIMIT 10"
            
            document.getElementById('original').textContent = testSQL
            document.getElementById('formatted').textContent = formatSQLQuery(testSQL)
        }

        // Run test on load
        testFormatting()
    </script>
</body>
</html>